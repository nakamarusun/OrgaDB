{% extends 'general_template.html' %}
<!-- Todo : Create committee, members, guests section -->

{% block head %}
<link rel="stylesheet" href="{{url_for('static', filename='event_template.css')}}">
{% endblock %}

{% block left_cont %}
{{ m.event_nav() }}
{% endblock %}

{% block right_cont %}
<div class="container flex flex-col px-12">
    <h1 class="text-center text-2xl pt-6 pb-4">Members</h1>
    <div class="tab_container container flex h-18">
        <div class="tabs bg-gray-300 cursor-pointer p-3 w-28 text-center border-2 rounded-t-lg"><b>Committee</b></div>
        <div class="tabs bg-gray-300 cursor-pointer p-3 w-28 text-center border-2 rounded-t-lg"><b>Volunteer</b></div>
        <div class="tabs bg-gray-300 cursor-pointer p-3 w-28 text-center border-2 rounded-t-lg"><b>Guests</b></div>
    </div>
    
    <table class="content container border-2 table-auto">
        <tr>
            <th class="border-2 h-10">ID</th>
            <th class="border-2 h-10">Name</th>
            <th class="border-2 h-10">Position</th>
            <th class="border-2 h-10">Clearance</th>
            <th class="border-2 h-10 w-14">Edit</th>
        </tr>

        <!-- Commented out jinja template -->
        <!-- Calls function to display table contents, accepts a dictionary of content as argument-->
        {{ m.table_content(committee_dict) }}
        <!-- Placeholder values -->
        <tr>
            <td class="border-2 h-10">1</td>
            <td class="border-2 h-10">Chaika</td>
            <td class="border-2 h-10">Best girl</td>
            <td class="border-2 h-10">1</td>
            <td class="border-2 h-10">
                <img src="{{url_for('static',filename='asset/pencil.svg')}}" class="edit m-auto w-6 h-6 cursor-pointer" alt="">
                <input type="image" src="{{url_for('static',filename='asset/check.svg')}}" class="submit m-auto w-6 h-6" alt="">
            </td>
        </tr>
    </table>
    <table class="content container border-2 table-auto">
        <tr>
            <th class="border-2 h-10">ID</th>
            <th class="border-2 h-10">Name</th>
            <th class="border-2 h-10">Position</th>
            <th class="border-2 h-10">Clearance</th>
            <th class="border-2 h-10 w-14">Edit</th>
        </tr>
        
            {{ m.table_content(volunteer_dict) }}

        <!-- Placeholder values -->
        <tr>
            <td class="border-2 h-10">2</td>
            <td class="border-2 h-10">Gay</td>
            <td class="border-2 h-10">Bouncer</td>
            <td class="border-2 h-10">2</td>
            <td class="border-2 h-10">
                <img src="{{url_for('static',filename='asset/pencil.svg')}}" class="edit m-auto w-6 h-6 cursor-pointer" alt="">
                <input type="image" src="{{url_for('static',filename='asset/check.svg')}}" class="submit m-auto w-6 h-6" alt="">
            </td>
        </tr>
    </table>
    <table class="content container border-2 table-auto">
        <tr>
            <th class="border-2 h-10">ID</th>
            <th class="border-2 h-10">Name</th>
            <th class="border-2 h-10">Position</th>
            <th class="border-2 h-10">Phone number</th>
            <th class="border-2 h-10">Mail</th>
            <th class="border-2 h-10 w-14">Edit</th>
        </tr>
            {{ m.table_content(guest_dict) }}
        
        <!-- Placeholder values -->
        <tr>
            <td class="border-2 h-10">3</td>
            <td class="border-2 h-10">Haha</td>
            <td class="border-2 h-10">LOL!</td>
            <td class="border-2 h-10">+1203912803</td>
            <td class="border-2 h-10">hotMail</td>
            <td class="border-2 h-10">
                <img src="{{url_for('static',filename='asset/pencil.svg')}}" class="edit m-auto w-6 h-6 cursor-pointer" alt="">
                <input type="image" src="{{url_for('static',filename='asset/check.svg')}}" class="submit m-auto w-6 h-6" alt="">
            </td>
        </tr>
    </table>
    
    <div class="form-wrapper">
        <form action="" method="post" class="form-panel flex flex-col flex-grow w-full border-gray-300 border-b-2 border-l-2 border-r-2 rounded-b-md">
            <div class="grid gap-x-4 px-2 grid-cols-3 md:grid-cols-3 w-full sm:h-24 md:h-16 rounded-b-md bg-green-200 md:py-3">
                <input type="text" required name="Id" class="rounded border px-2 outline-none focus:ring-2 my-1 md:my-0" placeholder="ID" pattern="[0-9]+" >
                <select required class="rounded border outline-none px-2 my-1 md:my-0 focus:ring-2" name="Position">
                    <option value="Gamer" selected> Gamer </option>
                    <option value="Owner">Owner</option>
                    <option value="I don't know">I don't know</option>
                </select>
                <select required class="rounded border outline-none px-2 my-1 md:my-0 focus:ring-2" name="Clearance">
                    <option value="1" selected>Clearance level : 1</option>
                    <option value="2">Clearance level : 2</option>
                    <option value="3">Clearance level : 3</option>
                </select>    
            </div>
            <div class="w-full flex justify-end pr-2 py-2">
                <input type="submit" value="Add Item" class="w-16 border-b-4 border transition w-20 bg-white p-1 text-center hover:bg-green-300 hover:border-green-400 hover:text-white">
            </div>
        </form>
        <div class="w-full flex justify-end h-6">
            <div class="w-12 bg-gray-100 border-b-2 border-l-2 border-r-2 flex justify-center mr-2 show-form">
                <img src="{{url_for('static',filename='asset/chevron-down.svg')}}" alt="" class="chevron-down transition h-6 w-6">
            </div>
        </div>
    </div>
    <div class="form-wrapper">
        <form action="" method="post" class="form-panel flex flex-col flex-grow w-full border-gray-300 border-b-2 border-l-2 border-r-2 rounded-b-md">
            <div class="grid gap-x-4 px-2 grid-cols-3 md:grid-cols-3 w-full sm:h-24 md:h-16 rounded-b-md bg-green-200 md:py-3">
                <input type="text" required name="Id" class="rounded border px-2 outline-none focus:ring-2 my-1 md:my-0" placeholder="ID" pattern="[0-9]+" >
                <select required class="rounded border outline-none px-2 my-1 md:my-0 focus:ring-2" name="Position">
                    <option value="Gamer" selected> Gamer </option>
                    <option value="Owner">Owner</option>
                    <option value="I don't know">I don't know</option>
                </select>
                <select required class="rounded border outline-none px-2 my-1 md:my-0 focus:ring-2" name="Clearance">
                    <option value="1" selected>Clearance level : 1</option>
                    <option value="2">Clearance level : 2</option>
                    <option value="3">Clearance level : 3</option>
                </select>    
            </div>
            <div class="w-full flex justify-end pr-2 py-2">
                <input type="submit" value="Add Item" class="w-16 border-b-4 border transition w-20 bg-white p-1 text-center hover:bg-green-300 hover:border-green-400 hover:text-white">
            </div>
        </form>
        <div class="w-full flex justify-end h-6">
            <div class="w-12 bg-gray-100 border-b-2 border-l-2 border-r-2 flex justify-center mr-2 show-form">
                <img src="{{url_for('static',filename='asset/chevron-down.svg')}}" alt="" class="chevron-down transition h-6 w-6">
            </div>
        </div>
    </div>
    <div class="form-wrapper">
        <form action="" method="post" class="form-panel flex flex-col flex-grow w-full border-gray-300 border-b-2 border-l-2 border-r-2 rounded-b-md">
            <div class="grid gap-x-4 px-2 grid-cols-2 md:grid-cols-2 w-full sm:h-24 md:h-16 rounded-b-md bg-green-200 md:py-3">
                <input type="text" required name="name" class="rounded border px-2 outline-none focus:ring-2 my-1 md:my-0" placeholder="Name">
                <select required class="rounded border outline-none px-2 my-1 md:my-0 focus:ring-2" name="position">
                    <!-- Todo replace this with autogenerated flask -->
                    <option value="Gamer" selected> Gamer </option>
                    <option value="Owner">Owner</option>
                    <option value="I don't know">I don't know</option>
                </select>    
            </div>
            <div class="w-full flex justify-end pr-2 py-2">
                <input type="submit" value="Add Item" class="w-16 border-b-4 border transition w-20 bg-white p-1 text-center hover:bg-green-300 hover:border-green-400 hover:text-white">
            </div>
        </form>
        <div class="w-full flex justify-end h-6">
            <div class="w-12 bg-gray-100 border-b-2 border-l-2 border-r-2 flex justify-center mr-2 show-form">
                <img src="{{url_for('static',filename='asset/chevron-down.svg')}}" alt="" class="chevron-down transition h-6 w-6">
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <script>
        // Initializes global variables
        var activeTable = 0;
    </script>
    <script src="{{url_for('static',filename='event_table.js')}}"></script>
    <script>
        
        // I'm not proud of this
        // This is a blunder of a code
        $('.edit').click(function(){
            $(this).css({'display' : 'none'});
            // Row that is being edited
            editRow = $(this).parent().parent();
            console.log(activeTable)
            if(activeTable != 2){
                // Initializes all default values into the new input
                defaultPositionVal = $(editRow).children('td').eq(2).text();
                defaultClearanceVal = $(editRow).children('td').eq(3).text();
                
                // Todo replace these positions with yeenya
                $(editRow).children('td').eq(2).html(`
                    <select class="m-auto text-center focus:ring-2 border outline-none" id="Position" required name="Position">
                        <option value="` + defaultPositionVal + `" selected hidden>` + defaultPositionVal + `</option>
                        <option value="Position x">Position x</option>
                        <option value="Position y">Position y</option>
                        <option value="Position z">Position z</option>
                    </select>   
                `);
                $(editRow).children('td').eq(3).html(`
                    <select class="m-auto text-center focus:ring-2 border outline-none" id="Clearance" required name="Clearance">
                        <option value="` + defaultClearanceVal + `" selected hidden> Clearance level : ` + defaultClearanceVal + `</option>
                        <option value="1">Clearance level : 1</option>
                        <option value="2">Clearance level : 2</option>
                        <option value="3">Clearance level : 3</option>
                    </select>
                `);

                // Activates second child (checkmark)
            } else{
                defaultNameVal = $(editRow).children('td').eq(1).text();
                defaultPositionVal = $(editRow).children('td').eq(2).text();
                defaultPhoneVal = $(editRow).children('td').eq(3).text().replace(/[^0-9.-/+]+/g,"")                
                defaultMailVal = $(editRow).children('td').eq(4).text()                
                
                $(editRow).children('td').eq(1).html('<input class="m-auto border focus:ring-2 outline-none text-center" id="Name" type="text" required name="Name" value='+ defaultNameVal + '>');
                $(editRow).children('td').eq(2).html(`
                    <select class="m-auto text-center focus:ring-2 border outline-none" id="Position" required name="Position">
                        <option value="` + defaultPositionVal + `" selected hidden>` + defaultPositionVal + `</option>
                        <option value="Position x">Position x</option>
                        <option value="Position y">Position y</option>
                        <option value="Position z">Position z</option>
                    </select>   
                `);
                $(editRow).children('td').eq(3).html('<input class="m-auto border focus:ring-2 outline-none text-center" id="Phone" type="text" required name="Phone" value='+ defaultPhoneVal + '>');
                $(editRow).children('td').eq(4).html('<input class="m-auto border focus:ring-2 outline-none text-center" id="Mail" type="text" required name="Mail" value='+ defaultMailVal + '>');
                
            }
            $(this).parent().children('input').css({'display':'block'});    
        })
        
        $('.submit').click(function(){
            // Serializes form data into string
        
            // Gets the row that is being edited
            editRow = $(this).parent().parent();
            
            // TODO : input validation
            var serializedForm = ""
            if(activeTable != 2){
                serializedForm += editRow.find('#Position').attr('name') + '=' + editRow.find('#Position').val()
                serializedForm += '&' + editRow.find('#Clearance').attr('name') + '=' + editRow.find('#Clearance').val()
                serializedForm += "&activeTable=" + activeTable;

                $(editRow).children('td').eq(2).html(editRow.find('#Position').val());
                $(editRow).children('td').eq(3).html(editRow.find('#Clearance').val());
            } else{
                serializedForm += editRow.find('#Name').attr('name') + '=' + editRow.find('#Name').val()
                serializedForm += '&' + editRow.find('#Position').attr('name') + '=' + editRow.find('#Position').val()
                serializedForm += '&' + editRow.find('#Phone').attr('name') + '=' + editRow.find('#Phone').val()
                serializedForm += '&' + editRow.find('#Mail').attr('name') + '=' + editRow.find('#Mail').val()
                serializedForm += "&activeTable=" + activeTable;
                
                $(editRow).children('td').eq(1).html(editRow.find('#Name').val());
                $(editRow).children('td').eq(2).html(editRow.find('#Position').val());
                $(editRow).children('td').eq(3).html(editRow.find('#Phone').val());
                $(editRow).children('td').eq(4).html(editRow.find('#Mail').val());
            }
            
            console.log(serializedForm);
            // Used to add a record on the front end
            var currentPath = window.location.pathname;
            $('.edit').css({'display' : 'block'});
            
            $.ajax({
                type : "POST",
                url : currentPath + "/update",
                data : serializedForm,
                success : function(){
                    alert("Succesfully added record");
                }
            });
            $('.submit').css({'display' : 'none'});
        });
    </script>
{% endblock %} 